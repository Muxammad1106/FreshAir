# Customer Features (Функционал для клиентов)

## Обзор

Customer (Клиент) - это основной пользователь платформы, который заказывает и использует устройства очистки воздуха для своих помещений.

## Возможности

### 1. Регистрация и аутентификация

- Регистрация с email и паролем
- Подтверждение email
- Вход в систему
- Восстановление пароля

### 2. Управление профилем

- Просмотр профиля
- Редактирование данных
- Добавление телефона и адреса

### 3. Управление помещениями (Rooms)

**Создание помещения:**
- Название помещения
- Тип помещения (HOME, COMMERCIAL, INDUSTRIAL)
- Площадь (м²)
- Высота потолка (м) - автоматически рассчитывается объем
- Адрес
- Город
- Заметки

**Функции:**
- Список всех помещений
- Редактирование помещения
- Удаление помещения
- Просмотр деталей помещения

### 4. Создание заказов

**Процесс создания заказа:**

1. **Выбор помещений** - можно выбрать одно или несколько помещений
2. **Выбор типов устройств** для каждого помещения:
   - Purifier (очистка воздуха)
   - Humidifier (увлажнение)
   - Aroma (ароматизация)
   - Combo (комбинированные устройства)

3. **Автоматический расчет стоимости:**
   - 0.10 USD за м³ для очистки/увлажнения
   - 0.05 USD за м³ для ароматизации
   - Если выбраны очистка и увлажнение, арома добавляется бесплатно

4. **Создание заказа** со статусом `PENDING`

**Статусы заказа:**
- `PENDING` - Ожидает оплаты
- `APPROVED` - Оплачен, готов к установке
- `INSTALLED` - Устройства установлены
- `ACTIVE` - Активен и работает
- `CANCELLED` - Отменен

### 5. Оплата заказов

**Процесс оплаты:**

1. Выбор или добавление платежной карты
2. Подтверждение оплаты
3. Автоматическое создание:
   - Записи `Payment` со статусом `PAID`
   - Изменение статуса заказа на `APPROVED`
   - Создание `DeviceInstance` для каждого устройства
   - Связывание устройств с заказом

**Платежные карты:**
- Добавление карты (номер, срок действия, CVV)
- Выбор карты по умолчанию
- Редактирование карты
- Удаление карты

### 6. Управление устройствами

**Функции:**
- Просмотр списка всех устройств
- Просмотр деталей устройства
- Включение/выключение устройства (toggle)
- Просмотр метрик устройства в реальном времени

**Метрики устройства:**
- PM2.5 (качество воздуха)
- Влажность (%)
- Объем очищенного воздуха (м³)
- Износ фильтра (%)
- Уровень жидкости (%) - для увлажнителей

### 7. История платежей и аналитика

**История транзакций:**
- Список всех платежей
- Детали каждой транзакции
- Статусы платежей (PAID, PENDING, FAILED)

**Аналитика:**
- Общая сумма потраченных средств
- Количество транзакций
- Статистика за последние 30 дней
- Статистика за последние 7 дней
- Графики расходов по месяцам
- Средний чек

## API Endpoints

### Rooms (Помещения)

```
GET    /api/v1/core/customer/rooms              # Список помещений
POST   /api/v1/core/customer/rooms              # Создать помещение
GET    /api/v1/core/customer/rooms/{id}         # Детали помещения
PUT    /api/v1/core/customer/rooms/{id}         # Обновить помещение
DELETE /api/v1/core/customer/rooms/{id}         # Удалить помещение
```

### Orders (Заказы)

```
GET    /api/v1/core/customer/orders             # Список заказов
POST   /api/v1/core/customer/orders             # Создать заказ
GET    /api/v1/core/customer/orders/{id}        # Детали заказа
POST   /api/v1/core/customer/orders/{id}/pay    # Оплатить заказ
```

### Devices (Устройства)

```
GET    /api/v1/core/customer/devices            # Список устройств
GET    /api/v1/core/customer/devices/{id}       # Детали устройства
PATCH  /api/v1/core/customer/devices/{id}/toggle # Включить/выключить
GET    /api/v1/core/customer/devices/{id}/metrics # Метрики устройства
```

### Payment Cards (Платежные карты)

```
GET    /api/v1/core/customer/payment-cards      # Список карт
POST   /api/v1/core/customer/payment-cards      # Добавить карту
GET    /api/v1/core/customer/payment-cards/{id} # Детали карты
PUT    /api/v1/core/customer/payment-cards/{id} # Обновить карту
DELETE /api/v1/core/customer/payment-cards/{id} # Удалить карту
```

### Payments (Платежи)

```
GET    /api/v1/core/customer/payments           # История платежей + аналитика
```

## Пользовательские сценарии

### Сценарий 1: Первый заказ

1. Пользователь регистрируется
2. Добавляет помещение (например, "Гостиная", 50 м²)
3. Создает заказ с выбором устройства Purifier
4. Добавляет платежную карту
5. Оплачивает заказ
6. После оплаты автоматически создается DeviceInstance
7. Устройство появляется в списке устройств со статусом ACTIVE

### Сценарий 2: Мониторинг устройства

1. Пользователь открывает страницу Devices
2. Видит список всех своих устройств
3. Нажимает на устройство для просмотра деталей
4. Просматривает метрики в реальном времени:
   - Текущий PM2.5: 12.5
   - Влажность: 48%
   - Очищено воздуха: 1250 м³
   - Износ фильтра: 22%
5. Может включить/выключить устройство

### Сценарий 3: Просмотр аналитики

1. Пользователь переходит в раздел Payment
2. Видит вкладку "История транзакций"
3. Просматривает все свои платежи
4. Видит аналитику:
   - Всего потрачено: $1,234.56
   - За 30 дней: $456.78
   - За 7 дней: $123.45
5. Просматривает график расходов по месяцам

## Тестовые данные

Для демонстрации используется аккаунт:
- Email: `demo@freshair.com`
- Password: `password`

Этот аккаунт содержит полный набор мок-данных:
- Несколько помещений
- Активные заказы
- Устройства с метриками
- История платежей
- Платежные карты

