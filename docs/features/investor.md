# Investor Features (Функционал для инвесторов)

## Обзор

Investor (Инвестор) - это пользователь, который инвестирует средства в устройства очистки воздуха и получает прибыль на основе их использования.

## Возможности

### 1. Регистрация и аутентификация

- Регистрация с ролью INVESTOR
- Подтверждение email
- Вход в систему
- Восстановление пароля

### 2. Управление профилем

- Просмотр профиля инвестора
- Редактирование данных
- Указание бюджета (budget_usd)

### 3. Просмотр доступных устройств

**Доступные устройства для инвестиций:**
- Список всех активных устройств, доступных для инвестиций
- Информация о каждом устройстве:
  - Тип устройства
  - Расположение (комната, адрес)
  - Текущий статус
  - Минимальная/максимальная сумма инвестиции
  - Процент прибыли
  - Период инвестиции

### 4. Создание инвестиций

**Процесс инвестирования:**

1. **Выбор устройства** из списка доступных
2. **Указание суммы инвестиции:**
   - Должна быть в пределах min_investment_usd - max_investment_usd
   - Сумма в USD

3. **Создание инвестиции** со статусом `PENDING`

4. **Подтверждение оплаты:**
   - После оплаты статус меняется на `PAID`
   - Устанавливается дата оплаты (paid_at)
   - Инвестиция становится активной

**Статусы инвестиции:**
- `PENDING` - Ожидает оплаты
- `PAID` - Оплачена, активна
- `COMPLETED` - Завершена (возврат средств)

### 5. Мониторинг портфолио

**Дашборд инвестора показывает:**
- Общая сумма инвестиций (USD)
- Количество активных устройств
- Общий объём очищенного воздуха (м³)
- Общее количество часов увлажнения
- Прогнозируемый общий доход (USD)
- Дата прогнозируемого возврата

**Статистика по каждой инвестиции:**
- Сумма инвестиции
- Текущая доходность
- Прогнозируемая доходность
- Объем очищенного воздуха устройством
- Количество часов работы
- Прогнозируемый возврат

### 6. Расчет прибыли

**Модель расчета:**
- Прибыль рассчитывается на основе метрик устройства
- Процент прибыли определяется типом устройства (investment_profit_percentage)
- Период инвестиции указан в месяцах (investment_period_months)

**Факторы влияния:**
- Объем очищенного воздуха (м³)
- Время работы устройства
- Активность использования

**Снапшоты статистики:**
- Система периодически создает InvestmentStatSnapshot
- Сохраняет текущие метрики и прогнозы
- Позволяет отслеживать изменение доходности

## API Endpoints

### Dashboard

```
GET /api/v1/core/investor/dashboard           # Дашборд с общей статистикой
```

### Available Devices

```
GET /api/v1/core/investor/devices/available   # Список доступных устройств для инвестиций
```

### Investments

```
GET    /api/v1/core/investor/investments      # Список инвестиций
POST   /api/v1/core/investor/investments      # Создать инвестицию
GET    /api/v1/core/investor/investments/{id} # Детали инвестиции
POST   /api/v1/core/investor/investments/{id}/confirm-payment # Подтвердить оплату
```

## Модель данных

### Investment

```python
class Investment:
    investor: User (INVESTOR role)
    device: DeviceInstance
    status: PENDING | PAID | COMPLETED
    amount_usd: Decimal
    paid_at: DateTime (nullable)
    created_at: DateTime
    updated_at: DateTime
```

### InvestmentStatSnapshot

```python
class InvestmentStatSnapshot:
    investment: Investment
    device: DeviceInstance
    timestamp: DateTime
    cumulative_cleaned_air_volume_m3: Float
    cumulative_humidity_hours: Float
    projected_return_amount: Decimal
    projected_return_date: Date
```

## Пользовательские сценарии

### Сценарий 1: Первая инвестиция

1. Инвестор регистрируется и входит в систему
2. Переходит в раздел "Portfolio"
3. Просматривает доступные устройства для инвестиций
4. Выбирает устройство (например, Purifier X100 в офисе)
5. Указывает сумму инвестиции ($500)
6. Создает инвестицию (статус PENDING)
7. Подтверждает оплату
8. Инвестиция становится активной (статус PAID)
9. Система начинает отслеживать метрики устройства

### Сценарий 2: Мониторинг портфолио

1. Инвестор открывает дашборд
2. Видит общую статистику:
   - Всего инвестировано: $5,000
   - Активных устройств: 10
   - Очищено воздуха: 50,000 м³
   - Прогнозируемый доход: $1,250
3. Просматривает детали каждой инвестиции
4. Видит текущую доходность и прогнозы

### Сценарий 3: Отслеживание доходности

1. Система периодически создает снапшоты статистики
2. Инвестор просматривает историю изменения доходности
3. Видит графики роста:
   - Рост объема очищенного воздуха
   - Рост прогнозируемого дохода
   - Приближение к дате возврата

## Бизнес-логика

### Условия инвестирования

1. Устройство должно быть активным (status = ACTIVE)
2. Устройство должно иметь инвестиционные параметры:
   - min_investment_usd
   - max_investment_usd
   - investment_profit_percentage
   - investment_period_months

### Расчет прибыли

Формула базового расчета:
```
projected_return = amount_usd * (investment_profit_percentage / 100)
```

Дополнительные факторы:
- Фактическое использование устройства влияет на реальную доходность
- Метрики устройства (очищенный воздух, время работы) учитываются в расчетах

### Возврат инвестиции

После завершения периода инвестиции:
- Статус меняется на COMPLETED
- Возвращается основная сумма + прибыль
- Инвестор получает финальную статистику

## Тестовые данные

Для демонстрации можно использовать аккаунты:
- Email: `investor1@freshair.com`
- Password: `password`

Или создать нового инвестора через регистрацию с ролью INVESTOR.

